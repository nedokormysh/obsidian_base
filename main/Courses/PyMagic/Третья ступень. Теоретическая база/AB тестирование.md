
Зачем нам A/B тестирование? 
• Количественная оценка влияния нашего алгоритма, действия или некоторой новой функциональности на продукт. 
• Метод, с помощью которого можно доказать увеличение бизнесметрик вследствие сделанных нами изменений 
• Честная проверка любой продуктовой гипотезы
• Статистический метод принятия решений

# Общий пайплайн АБ тестирования

![[Pasted image 20241027190129.png]]

X – случайная величина, которая может принимать некоторые значения с разной вероятностью. X - имеет некоторое вероятностное распределение P.

• Нулевая гипотеза H_0: некоторая гипотеза о распределении величины X. В нашем случае X имеет биномиальное распределение с параметром 1/2. (Вероятность выпадения орла – ½, монетка честная)
• Альтернатива H_1: некоторая альтернативная гипотеза о распределении величины X. X имеет биномиальное распределение с параметром, не равным 1/2. (Вероятность выпадения орла не равняется 1/2, монетка нечестная)

• Статистика: 
	• T(X^n) имеет некоторое распределение F(x) при справедливости гипотезы H_0 ,
	• T(X^n) не распределена в соответствии с F(x) при справедливости альтернативной гипотезы H_1
 • T – некоторая статистика, посчитанная по выборке. В случае с монеткой – процентное колво орлов во всех бросках. 
 • Выборка в нашем конкретном случае: x^n = (x_1, … , x_n) , t = T(x^n) посчитанная на нашей выборке статистика. (Например, провели 100 бросков, получили 55 орлов)


## Проверка гипотез
• Выборка X^n =(X_1, … , X^n) ,
• Нулевая гипотеза H_0 - некоторое предположение о распределении X
• Альтернатива H_1 - альтернативное предположение о распределении X
• Статистика: 
	• T(X^n), имеет распределение F(x) при справедливости H_0,
	• T(X^n), не имеет распределение F(x) при справедливости H_1,
• Выборка в нашем конкретном случае: x^n = (x_1, … , x_n) , t = T(x^n) посчитанная на нашей выборке статистика. 
• Достигаемый уровень значимости: p(x^n) − вероятность при H_0 получить T(x^n) = t или еще более экстремальное значение. 
• p(x^n) = P(T>=t H_0) − p-value
• Гипотеза отвергается при p(x^n) ≤ \alpha, \alpha − уровень значимости

Если величина p(x^n) достаточно мала, то данные свидетельствуют против нулевой гипотезы в пользу альтернативы. 
Если величина p(x^n) не достаточно мала, то данные не свидетельствуют против нулевой гипотезы в пользу альтернативы.

При помощи инструмента проверки гипотез нельзя доказать справедливость нулевой гипотезы. При помощи инструмента проверки гипотез не всегда можно сделать причинноследственную связь между событиями. Достигаемый уровень значимости нельзя интерпретировать как вероятность справедливости нулевой гипотезы!

Ошибка первого и второго рода

• Задача проверки гипотез несимметрична. ( Мы должны учитывать по-разному наши ошибки) 
• Ограничиваем вероятность ошибки первого рода \alpha. (количество ложноположительных случаев ограничиваем 5%) 
• Минимизируем ошибку второго рода. ( Хотим как можно чаще находить различия, когда они действительно есть)
• Корректность P(p(T) <= \alpha | H_0) <= \alpha
  Мощность (1-\beta (ошибка второго рода ))

## Основные статистические критерии

Подбор критерия 

### Параметрические критерии
• Параметрические критерии проверки гипотез допускают дополнительное знание о распределении выборок, что позволяет составлять более мощные критерии.
• К сожалению, реальные данные очень редко распределены как табличные распределения. Но есть ряд популярных случаев, когда это так.

t-критерий Стьюдента

Особенности применимости критерия • Для точного t-теста данные должны иметь нормальное распределение; • Часто достаточно того, что данные имеют асимптотически нормальное распределение; • Желательно применять критерий, когда размер выборок больше 30 наблюдений; • Желательно примерное равенство дисперсий в выборках; • С ростом выборки распределение сходится к нормальному; • Является одним из самых мощных критериев; • При неизвестных дисперсиях нужно, чтобы выборки были примерно одинаковые; • Если выборки разного объема, то выборка с большей дисперсией не должна превышать выборку с меньшей дисперсией.

### Непараметрические критерии
• Для непараметрических критериев не нужно знать точное распределение выборки; • Непараметрические критерии хорошо подходят для маленьких выборок;
• Подходят для нестандартных распределений; 
• Имеют меньшую мощность, чем параметрические критерии.

Критерий Манна-Уитни

Особенности применимости критерия 
•  Зависимая переменная должна измеряться по порядковой или непрерывной шкале. • Группы должны быть однородны по независимым переменным. • Наблюдения должны быть независимыми. Другими словами, не должно быть никакой связи между двумя группами или внутри каждой группы. • Наблюдения обычно не распределены нормально. Однако они должны иметь одинаковую форму. • В каждой группе должно быть хотя бы 20 наблюдений. • Желательно, чтобы не было повторяющихся значений или их было очень мало.

## Мощность и корректность

p-value и корректность 
• p-value – вероятность при справедливости H_0 получить такое значение статистики или еще более экстремальное, которое мы посчитали на нашей выборке T(X^n) = t
• Гипотеза отвергается при p-value ≤ \alpha, \alpha − уровень значимости (обычно берут 0.05) Процент ложноположительных ошибок должен не превышать 5%
• Корректность критерия: P(p(T) <= \alpha | H_0) <= \alpha. Провели 1000 раз эксперимент, оценили в скольких случаях был ложноположительный результат.(То есть когда p-value было меньше 0.05.)
• Но просто числа корректности нам не достаточно, корректность нужно оценить на исторических данных!

A/A тест как оценка корректности 
Делаем следующую процедуру: 
• выделяем n пар похожих групп A и A из выборки на исторических данных 
• сравниваем стат. критерием наши группы в каждой паре и запоминаем p-value 
• считаем процент пар, в которых p-value ≤ \alpha: т.е считаем в скольких случаях критерий (сработал) нашел различия, когда его на самом деле нет.
• Процент пар не должен превышать \alpha для корректности нашего критерия, но этого условия недостаточно.

Распределение p-value, которое мы получили после A/A теста на исторических данных, должно быть распределено равномерно! Без этого наши выводы будут смещены, критерий и A/B тест будут некорректными.

Мощность критерия: pow =P(p(T)) ≤ \alpha | H_1) → max вероятность отвергнуть H_0 , если верна альтернатива Мощность критерия зависит от следующих факторов:
1. размер выборки; 2. размер отклонения от нулевой гипотезы; 3. чувствительность статистики критерия; 4. тип альтернативы.
