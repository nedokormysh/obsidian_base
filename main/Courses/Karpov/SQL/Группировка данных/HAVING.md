
что если в результат группировки и агрегации мы хотим включить не все группы, а только те, для которых выполняется некоторое условие? Например, только те размеры заказов, количество которых выше или ниже определённого значения? Или только те возрастные группы, количество пользователей в которых превышает заданный порог?

Судя по всему, для этого нам необходимо каким-то образом наложить фильтрацию уже поверх группировки. Но, как мы выяснили, оператор `WHERE` использовать после `GROUP BY` нельзя. Что же тогда делать?

Специально для таких случаев существует оператор `HAVING`, который тоже выполняет функцию фильтрации, но работает поверх уже сгруппированных данных.

В этом и заключается ключевое отличие операторов `WHERE` и `HAVING`: первый фильтрует записи в таблице перед группировкой и агрегацией, а второй — после. Кстати, это простой, но довольно популярный вопрос на собеседовании по SQL.

Ещё одна важная особенность работы оператора `HAVING`: в этом блоке нельзя указывать алиасы полей с результатом агрегации из блока `SELECT`. Дело в том, что в соответствии с порядком выполнения запроса оператор `SELECT` выполняется после оператора `HAVING`. Поэтому агрегацию необходимо также указывать и в `HAVING`.


[[Группировка_данных_content]]