Теперь решим ещё одну задачу и заодно познакомимся с новой функцией `array_length`.

Как вы помните, в таблице `orders` содержимое заказов представлено в виде списков товаров (массивов). Чтобы посчитать количество товаров в каждом заказе, можно как раз воспользоваться функцией `array_length`.

Функция `array_length` вычисляет количество элементов в массиве (длину массива) и записывается следующим образом:

SELECT array_length(ARRAY[1,2,3], 1) Результат: 3

---

Синтаксис может показаться вам немного сложным, но это только на первый взгляд! Давайте разбираться. 

`ARRAY[1,2,3]` — это некоторый список из трёх значений: 1, 2 и 3.

Единица в качестве второго аргумента — это размерность массива, по которой считается его длина. Так как список у нас одноразмерный (просто значения, записанные в одну строчку), то выбор у нас невелик — можем указать только первую размерность.

Если бы у нас была таблица `N x N`, в которой были бы и строки, и столбцы, то размерности было бы две: первая соответствовала бы количеству строк, а вторая — числу столбцов. В таком случае мы могли бы указать либо первую, либо вторую размерность.

Давайте представим, что у нас есть простая таблица следующего вида:

_______ | 1 | 2 | | 3 | 4 | | 5 | 6 | ‾‾‾‾‾‾‾

---

В этой таблице 3 строки и 2 столбца, поэтому её можно описать в виде следующего списка из трёх вложенных в него списков:

ARRAY[[1,2], [3,4], [5,6]]

---

В примере выше количество списков внутри основного списка — это количество строк в таблице, а количество элементов внутри каждого внутреннего списка — это количество столбцов.

SELECT array_length(ARRAY[[1,2], [3,4], [5,6]], 1)

Результат:
3

SELECT array_length(ARRAY[[1,2], [3,4], [5,6]], 2)

Результат:
2

## **Задание:**

Посчитайте количество заказов в таблице `orders` с девятью и более товарами. Для этого воспользуйтесь функцией `array_length`, отфильтруйте данные по количеству товаров в заказе и проведите агрегацию. Полученный столбец назовите `orders`.

Поле в результирующей таблице: `orders`

---

**Пояснение:**

В наших данных в колонке `product_ids` содержатся обычные списки товаров всего с одной размерностью.

SELECT count(order_id) as orders
FROM   orders
WHERE  array_length(product_ids, 1) >= 9



[[Аггрегация_данных_content]]