Ещё одно важное направление применения подзапросов — создание более продвинутых условных выражений в операторах `WHERE` и `HAVING`. Но поскольку и в том, и в другом случае синтаксис и назначение подзапросов примерно одинаковые, в этом уроке мы будем рассматривать всё на примере подзапросов в `WHERE`.

В первую очередь важно понять, что подзапрос, возвращающий одно значение, может использоваться совместно с операторами сравнения.

Иными словами, вы можете составить подзапрос, возвращающий одно значение (как правило, это результат работы агрегирующих функций), а затем сравнить с этим значением (т.е. с подзапросом) все значения в одной из колонок таблицы.

Давайте представим, что нам нужно сравнить значения в каком-то столбце с максимальным, минимальным или средним значением в этом же столбце — такая задача довольно часто встречается на практике. Сделать это в рамках одного запроса точно не получится, поскольку, как мы уже знаем, агрегирующие функции нельзя применять в блоке `WHERE`.

Первое, что приходит в голову, — написать примерно такой запрос:

SELECT column
FROM table
WHERE column = MAX(column)

Но по понятным причинам работать он не будет, и база данных сообщит об ошибке.

Однако хотя запрос и некорректный, его логика в целом правильная: нам действительно нужно найти максимальное значение в колонке и сравнить с ним все значения в этой же колонке. Единственное, что мы забыли, когда считали максимальное значение, это обратиться к самой таблице.

Давайте это исправим и перепишем запрос следующим образом:

SELECT column
FROM table
WHERE column = (SELECT MAX(column) FROM table)

В результате выполнения такого запроса мы получим все значения в колонке `column`, равные максимальному значению в этой колонке.

Такой запрос отработает уже без ошибок, так как подзапрос с расчётом максимального значения выполнится первым и вернёт одно значение.

А теперь ещё одна несложная задача.

## **Задание:**

Выведите из таблицы `products` информацию о всех товарах кроме самого дешёвого.

Результат отсортируйте по убыванию id товара.

Поля в результирующей таблице: `product_id`, `name`, `price`

SELECT *
FROM   products
WHERE  price != (SELECT min(price)
                 FROM   products)
ORDER BY product_id desc

SELECT product_id,
       name,
       price
FROM   products
WHERE  price != (SELECT min(price)
                 FROM   products)
ORDER BY product_id desc