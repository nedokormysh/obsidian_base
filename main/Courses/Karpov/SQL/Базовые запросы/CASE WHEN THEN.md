
А что если бы мы захотели повысить цену не на все товары, а, скажем, только на дорогие?

Для этого нам бы потребовалось создать некоторую функцию, которая проверяла бы каждое значение в колонке `price` и сравнивала бы его с каким-то пороговым значением. Если бы цена оказывалась выше этого порога, то функция повышала бы цену, а если нет — оставляла бы без изменений.

И такую функцию как раз можно задать с помощью условной конструкции `CASE`. Она имеет следующий синтаксис:

CASE  
WHEN logical_expression_1 THEN expression_1
WHEN logical_expression_2 THEN expression_2
...
ELSE expression_else
END AS case_example

Эта конструкция может показаться громоздкой, но на самом деле в ней нет ничего сложного. Логика работы оператора `CASE` довольно простая:

1. На каждом этапе WHEN – THEN вычисляется некоторое логическое выражение logical_expression, стоящее после `WHEN`. Если оно оказывается истинным (`TRUE`), то в качестве результата оператор возвращает выражение expression, стоящее после `THEN`, и заканчивает свою работу.
2. Если выражение оказывается ложным (`FALSE`), то оператор продолжает работу и проверяет следующее условие.  
    
3. Если ни одно из условий не проходит проверку на истинность, то возвращается выражение, указанное после `ELSE`. При этом `ELSE` указывать не обязательно — если его не указать, то вернётся пустое значение `NULL` (в случае, если все проверки после `WHEN` оказались ложными).  
    
4. В конце обязательно указывается ключевое слово `END`, которое говорит об окончании конструкции `CASE`. Также после `END` новому расчётному полю с помощью `AS` можно присвоить некоторое имя, но это делать не обязательно. Обязательными являются только ключевые слова `CASE`,  `WHEN`,  `THEN` и `END`.

SELECT name,
       CASE 
       WHEN name='свинина' OR name='баранина' OR name='курица' THEN 'мясо'
       WHEN name='треска' OR name='форель' OR name='окунь' THEN 'рыба'
       ELSE 'другое'
       END AS сategory
FROM table

К операторам сравнения относятся:

- `=` («равно»)
- `<>` или `!=` («не равно»)
- `<` («меньше»)
- `>` («больше»)
- `<=` («меньше или равно»)
- `>=` («больше или равно»)

---

Результатом работы операторов сравнения могут быть три состояния:

- `TRUE` («истина»)
- `FALSE` («ложь»)  
    
- `NULL` («неопределённое состояние» — когда одно из сравниваемых значений `NULL`)

---

С этими тремя состояниями можно проводить следующие логические операции:

- `AND` («И»)
- `OR` («ИЛИ»)
- `NOT` («НЕ»)

## **Задание:**

Повысьте цену на 5% только на те товары, цена которых превышает 100 рублей. Цену остальных товаров оставьте без изменений. Также не повышайте цену на икру, которая и так стоит 800 рублей. Выведите id и наименования всех товаров, их старую и новую цену. Цену округлять не нужно.

Результат отсортируйте сначала по убыванию новой цены, затем по возрастанию id товара.

Поля в результирующей таблице: `product_id`, `name`, `old_price`, `new_price`

SELECT product_id,
       name,
       price as old_price,
       case when price > 100 and
                 name != 'икра' then price*1.05
            else price end as new_price
FROM   products
ORDER BY new_price desc, product_id

SELECT product_id,
       name,
       price as old_price,
       case when price <= 100 or
                 name = 'икра' then price
            when price > 100 then price*1.05
            else 0 end new_price
FROM   products
ORDER BY new_price desc, product_id

[[Мат. функции. ROUND]]
[[Базовые_запросы_content]]